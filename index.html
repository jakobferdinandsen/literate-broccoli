<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>XP Programming</title>

        <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
        <script src="ckeditor/ckeditor.js"></script>
    </head>
    <body>
        <textarea id="text" name="myTextBox" style="width:100%; height:100%;"></textarea>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="bootstrap/js/bootstrap.js"></script>
        <script>CKEDITOR.replace('myTextBox')</script>
    </body>
</html>

<script>
    var interval;
    var lastText;
    $(function () {
        interval = setInterval(read, 500);
        CKEDITOR.instances['text'].on('change', (function () {
            write();
        }));
    });

    function read() {
        $.ajax({
            method: "GET",
            url: "/php/read.php",
            dataType: "json",
            async: false,
            success: function (data) {
                console.log(data.text);
                console.log(lastText);
                if (lastText !== data.text) {
                    CKEDITOR.instances['text'].setData(data.html);
                    lastText = data.text;
                }

            }
        });
    }

    function write() {
        var text = CKEDITOR.instances['text'].getData();
        $.ajax({
            method: "GET",
            url: "/php/write.php?",
            data: {
                text: text
            },
            async: false,
            dataType: "json"
        });
    }
</script>